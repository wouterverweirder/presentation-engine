{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/isomorphic-fetch/fetch-npm-browserify.js","node_modules/whatwg-fetch/fetch.js","src/mobile/js/classes/Presentation.js","src/mobile/js/script.js","src/shared/js/Constants.js","src/shared/js/classes/MobileServerBridge.js","src/shared/js/classes/Presentation.js","src/shared/js/classes/SlideBridge.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7cA;;AACA;;;;AACA;;;;;;;;;;;;IAEqB,Y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","file":"script.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// the whatwg-fetch polyfill installs the fetch() function\n// on the global object (window or self)\n//\n// Return that as the export for use in Webpack, Browserify etc.\nrequire('whatwg-fetch');\nmodule.exports = self.fetch.bind(self);\n","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    rawHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = 'status' in options ? options.status : 200\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n","import {Constants} from '../../../shared/js/Constants';\nimport PresentationBase from '../../../shared/js/classes/Presentation';\nimport MobileServerBridge from '../../../shared/js/classes/MobileServerBridge';\n\nexport default class Presentation extends PresentationBase{\n\n  constructor(data, role, settings) {\n    super(data, role, settings);\n    this.$overlay = $(`#overlay`);\n  }\n\n  createMobileServerBridge() {\n    return new MobileServerBridge(this, this.settings);\n  }\n\n  handleMobileServerMessage(message) {\n    if(!message.content) {\n      return;\n    }\n    if(message.content.action === `setCurrentSlideIndex`) {\n      this.setCurrentSlideIndex(message.content.currentSlideIndex);\n    } else if(message.content.action === Constants.BLINK) {\n      this.blink(message.content.text, message.content.backgroundColor);\n    }\n  }\n\n  setCurrentSlideIndex(index) {\n    super.setCurrentSlideIndex(index);\n    if(this.$overlay) {\n      this.$overlay.removeClass(`active`);\n    }\n    if(this.blinkInterval) {\n      clearInterval(this.blinkInterval);\n    }\n  }\n\n  blink(text, backgroundColor) {\n    //overlay important, blinking text\n    this.$overlay.find(`.content`).html(text);\n    this.$overlay.addClass(`active`);\n    if(this.blinkInterval) {\n      clearInterval(this.blinkInterval);\n    }\n    this.blinkInterval = setInterval(this.blinkToggle.bind(this, backgroundColor), 500);\n  }\n\n  blinkToggle(backgroundColor) {\n    this.$overlay.toggleClass(`blink-on`);\n    if(this.$overlay.hasClass(`blink-on`)) {\n      this.$overlay.css(`background-color`, backgroundColor);\n    } else {\n      this.$overlay.css(`background-color`, ``);\n    }\n  }\n\n}\n","import Presentation from './classes/Presentation';\nimport fetch from 'isomorphic-fetch';\n\n(() => {\n\n  const init = () => {\n    const settings = {\n      presentationPath: `/`,\n      mobileServerUrl: ``\n    };\n    //get slides by xmlhttprequest\n    fetch(`/data.json?t=${  Date.now()}`)\n      .then(data => data.json())\n      .then(data => {\n        new Presentation(data, `mobile`, settings);\n      });\n  };\n\n  init();\n})();\n","export const Constants = {\n  GO_TO_PREVIOUS_SLIDE: `goToPreviousSlide`,\n  GO_TO_NEXT_SLIDE: `goToNextSlide`,\n  SET_SLIDES: `setSlides`,\n  SET_CURRENT_SLIDE_INDEX: `setCurrentSlideIndex`,\n\n  MESSAGE: `message`,\n  SOCKET_SEND: `socketSend`,\n  SOCKET_RECEIVE: `socketReceive`,\n  JOIN_SLIDE_ROOM: `joinSlideRoom`,\n  LEAVE_SLIDE_ROOM: `leaveSlideRoom`,\n\n  ROLE_PRESENTATION: `presentation`,\n  ROLE_MOBILE: `mobile`,\n\n  STATE_ACTIVE: `active`,\n  STATE_INACTIVE: `inactive`,\n\n  SET_SUBSTATE: `setSubstate`,\n\n  CHILD_APP_SAVE_CODE: `childAppSaveCode`,\n  CHILD_APP_RUN_CODE: `childAppRunCode`,\n  CHILD_APP_STDOUT_DATA: `childAppStdoutData`,\n  CHILD_APP_STDERR_DATA: `childAppStderrData`,\n\n  OPEN_COMMAND_LINE: `openCommandLine`,\n  OPEN_CAMERA: `openCamera`,\n\n  BLINK: `blink`,\n\n  HEART_RATE_POLAR: `heartRatePolar`,\n\n  SET_TEAM: `setTeam`,\n  UPDATE_MOTION: `updateMotion`,\n\n  YOU_WIN: `youWin`,\n  YOU_LOSE: `youLose`,\n\n  SHAKE_YOUR_PHONES_INTRO: `shakeYourPhonesIntro`,\n  SHAKE_YOUR_PHONES_GAME: `shakeYourPhonesGame`,\n  SHAKE_YOUR_PHONES_FINISHED: `shakeYourPhonesFinished`,\n\n  SHAKE_YOUR_PHONES_CLIENT_ADDED: `shakeYourPhonesClientAdded`,\n  SHAKE_YOUR_PHONES_CLIENT_REMOVED: `shakeYourPhonesClientRemoved`,\n  SHAKE_YOUR_PHONES_CLIENT_LIST: `shakeYourPhonesClientList`,\n  SHAKE_YOUR_PHONES_CLIENT_UPDATE: `shakeYourPhonesClientUpdate`\n};\n","import fetch from 'isomorphic-fetch';\n\nexport default class MobileServerBridge {\n\n  constructor(presentation, settings) {\n    this.presentation = presentation;\n    this.settings = settings;\n    this.connect();\n  }\n\n  connect() {\n    if (!this.settings.mobileServerUrl) {\n      return;\n    }\n    console.log(`MobileServerBridge.connect`);\n    //console.warn('MobileServerBridge disabled');\n    //return;\n    //post to the api\n    fetch(`${this.settings.mobileServerUrl}/login`, {\n      method: `POST`,\n      body: JSON.stringify(this.getLoginCredentials()),\n      headers: new Headers({'Content-Type': `application/json`})\n    })\n    .then(response => response.json())\n    .then(result => this.loginHandler(result))\n    .catch(() => {\n      //retry after one second\n      setTimeout(() => this.connect(), 1000);\n    });\n  }\n\n  getLoginCredentials() {\n    return {\n      email: this.settings.mobileServerUsername,\n      password: this.settings.mobileServerPassword,\n    };\n  }\n\n  loginHandler(result) {\n    this.token = result.token;\n    this.socket = io(this.settings.mobileServerUrl, {\n      query: `token=${  this.token}`,\n      reconnection: false,\n      forceNew: true\n    });\n    this.socket.on(`connect`, this.socketConnectHandler.bind(this));\n    this.socket.on(`disconnect`, this.socketDisconnectHandler.bind(this));\n    this.socket.on(`message`, this.socketMessageHandler.bind(this));\n  }\n\n  socketConnectHandler() {\n    console.log(`MobileServerBridge.socketConnectHandler`);\n    this.presentation.mobileServerBridgeConnected();\n  }\n\n  socketDisconnectHandler() {\n    this.connect();\n  }\n\n  tryToSend() {\n    if(this.socket) {\n      this.socket.emit.apply(this.socket, arguments);\n    }\n  }\n\n  socketMessageHandler(message) {\n    this.presentation.mobileServerMessageHandler(message);\n  }\n}\n","import {Constants} from '../Constants';\nimport SlideBridge from './SlideBridge';\n\nexport default class Presentation {\n  /*\n   * data: json object with slides array property\n   * role: mobile or presentation\n   */\n  constructor(data, role, settings) {\n    this.data = data;\n    this.role = role;\n    this.settings = settings;\n    $(`#presentation`).attr(`data-presentation-settings`, JSON.stringify(settings));\n    this.currentSlideIndex = -1;\n    this.slideHolders = [];\n    this.numSlideHolders = 3;\n    this.slideBridges = [];\n    this.slideBridgesBySlideName = {};\n\n    this.createSlideHolders();\n    this.createSlideBridges(this.data);\n\n    this.mobileServerBridge = this.createMobileServerBridge();\n    this.startListeningForMessages();\n\n    this.setCurrentSlideIndex(0);\n  }\n\n  startListeningForMessages() {\n    window.addEventListener(`message`, this.slideMessageHandler.bind(this), false);\n  }\n\n  createSlideHolders() {\n    for(let i = 0; i < this.numSlideHolders; i++) {\n      const $slideHolder = $(`<div class=\"slide-frame\" />`);\n      this.slideHolders.push($slideHolder);\n      $(`#presentation`).append($slideHolder);\n    }\n  }\n\n  createSlideBridges(data) {\n    const numSlides = data.slides.length;\n    for(let i = 0; i < numSlides; i++) {\n      const slideBridge = this.createSlideBridge(data.slides[i]);\n      this.slideBridges.push(slideBridge);\n      this.slideBridgesBySlideName[slideBridge.name] = slideBridge;\n    }\n  }\n\n  createSlideBridge(slide) {\n    return new SlideBridge(slide);\n  }\n\n  slideMessageHandler(event) {\n    if(!event.data) {\n      return;\n    }\n    switch(event.data.action) {\n    case Constants.SOCKET_SEND:\n      if(this.mobileServerBridge) {\n        this.mobileServerBridge.tryToSend(Constants.MESSAGE, event.data.message);\n      }\n      break;\n    }\n  }\n\n  mobileServerBridgeConnected() {\n    //join the rooms of the slideHolders\n    for(let i = 0; i < this.numSlideHolders; i++) {\n      this.mobileServerBridge.tryToSend(Constants.JOIN_SLIDE_ROOM, $(this.slideHolders[i]).attr(`data-name`));\n    }\n  }\n\n  mobileServerMessageHandler(message) {\n    if(message.target.slide) {\n      //slide has to handle the message\n      const slideBridge = this.getSlideBridgeByName(message.target.slide);\n      if(slideBridge) {\n        slideBridge.tryToPostMessage({\n          action: Constants.SOCKET_RECEIVE,\n          message: message\n        });\n      }\n    } else {\n      //presentation has to handle the message\n      this.handleMobileServerMessage(message);\n    }\n  }\n\n  handleMobileServerMessage(message) {\n    console.log(`[shared/Presentation] handleMobileServerMessage`, message);\n  }\n\n  getSlideBridgeByIndex(index) {\n    if(index >= 0 && index < this.slideBridges.length) {\n      return this.slideBridges[index];\n    }\n    return false;\n  }\n\n  getSlideBridgeByName(slideName) {\n    return this.slideBridgesBySlideName[slideName];\n  }\n\n  getSlideHolderForSlide(slide, slidesNotToClear) {\n    if(slide) {\n      let $slideHolder = $(`.slide-frame[data-name=\"${  slide.name  }\"]`);\n      if($slideHolder.length > 0) {\n        return $slideHolder[0];\n      }\n      //get a free slideHolder\n      const slideNamesNotToClear = [];\n      $(slidesNotToClear).each(function(index, obj){\n        slideNamesNotToClear.push(obj.name);\n      });\n      const $slideHolders = $(`.slide-frame`);\n      for (let i = $slideHolders.length - 1; i >= 0; i--) {\n        $slideHolder = $($slideHolders[i]);\n        const name = $slideHolder.attr(`data-name`);\n        if(!name || slideNamesNotToClear.indexOf(name) === -1) {\n          return $slideHolder[0];\n        }\n      }\n    }\n    return false;\n  }\n\n  goToPreviousSlide() {\n    this.setCurrentSlideIndex(this.currentSlideIndex - 1);\n  }\n\n  goToNextSlide() {\n    this.setCurrentSlideIndex(this.currentSlideIndex + 1);\n  }\n\n  setCurrentSlideIndex(value) {\n    value = Math.max(0, Math.min(value, this.slideBridges.length - 1));\n    if(value !== this.currentSlideIndex) {\n      this.currentSlideIndex = value;\n\n      const currentSlideBridge = this.getSlideBridgeByIndex(this.currentSlideIndex);\n      const previousSlideBridge = this.getSlideBridgeByIndex(this.currentSlideIndex - 1);\n      const nextSlideBridge = this.getSlideBridgeByIndex(this.currentSlideIndex + 1);\n\n      //remove \"used\" class from slide holders\n      $(`.slide-frame`).removeAttr(`data-used`, false);\n\n      const currentSlideHolder = this.getSlideHolderForSlide(currentSlideBridge, [previousSlideBridge, nextSlideBridge]);\n      this.setupSlideHolder(currentSlideHolder, currentSlideBridge, Constants.STATE_ACTIVE, 0);\n\n      const previousSlideHolder = this.getSlideHolderForSlide(previousSlideBridge, [currentSlideBridge, nextSlideBridge]);\n      this.setupSlideHolder(previousSlideHolder, previousSlideBridge, Constants.STATE_INACTIVE, `-100%`);\n\n      const nextSlideHolder = this.getSlideHolderForSlide(nextSlideBridge, [previousSlideBridge, currentSlideBridge]);\n      this.setupSlideHolder(nextSlideHolder, nextSlideBridge, Constants.STATE_INACTIVE, `100%`);\n\n      //clear attributes of unused slide frames\n      $(`.slide-frame`).each(function(index, slideHolder){\n        if(!$(slideHolder).attr(`data-used`)) {\n          $(slideHolder).removeAttr(`data-used`).removeAttr(`data-name`).removeAttr(`data-src`);\n        }\n      });\n\n      //all other slideHolder bridges should be unlinked from their slideHolder\n      this.slideBridges.forEach(function(slideBridge){\n        if(slideBridge === currentSlideBridge) {\n          return;\n        }\n        if(slideBridge === previousSlideBridge) {\n          return;\n        }\n        if(slideBridge === nextSlideBridge) {\n          return;\n        }\n        slideBridge.slideHolder = null;\n      });\n\n      bean.fire(this, Constants.SET_CURRENT_SLIDE_INDEX, [this.currentSlideIndex]);\n    }\n  }\n\n  setupSlideHolder(slideHolder, slideBridge, state, left) {\n    if(slideHolder) {\n      let src = `slides/${  slideBridge.name  }.html`;\n      if(slideBridge.data[this.role] && slideBridge.data[this.role].url) {\n        src = slideBridge.data[this.role].url;\n      }\n      src = this.processSlideSrc(src);\n      if(slideBridge.isAlreadyCorrectlyAttached(slideHolder, src)) {\n        //console.log(slideBridge.name + ' already attached');\n      } else {\n        this.attachToSlideHolder(slideHolder, slideBridge, src);\n      }\n      slideBridge.setState(state);\n      $(slideHolder).css(`left`, left);\n      $(slideHolder).attr(`data-used`, 1);\n    }\n  }\n\n  attachToSlideHolder(slideHolder, slideBridge, src) {\n    //listen for events on this slideHolder\n    $(slideHolder).off(`message-from-slide`);\n    $(slideHolder).on(`message-from-slide`, (event, message) =>  {\n      this.slideMessageHandler({data: message});\n    });\n    //leave previous channel of this slideHolder\n    if(this.mobileServerBridge) {\n      this.mobileServerBridge.tryToSend(Constants.LEAVE_SLIDE_ROOM, $(slideHolder).attr(`data-name`));\n    }\n    //add the join as a callback for the onload event\n    slideBridge.attachToSlideHolder(slideHolder, src, this.slideLoaded.bind(this, slideHolder, slideBridge, src));\n  }\n\n  slideLoaded(slideHolder, slideBridge) { // eslint-disable-line no-unused-vars\n    //join new channel\n    if(this.mobileServerBridge) {\n      this.mobileServerBridge.tryToSend(Constants.JOIN_SLIDE_ROOM, $(slideHolder).attr(`data-name`));\n    }\n  }\n\n  processSlideSrc(src) {\n    return src;\n  }\n\n  createMobileServerBridge() {\n    //to implement in extending classes\n  }\n}\n","import fetch from 'isomorphic-fetch';\n\nexport default class SlideBridge {\n  constructor(data) {\n    this.data = data;\n    this.name = this.data.name;\n  }\n\n  isAlreadyCorrectlyAttached(slideHolder, src) {\n    return (this.slideHolder === slideHolder && $(slideHolder).attr(`data-name`) === this.name && $(slideHolder).attr(`data-src`) === src);\n  }\n\n  attachToSlideHolder(slideHolder, src, cb) {\n    this.slideHolder = slideHolder;\n    //notify the content it is being cleared\n    this.tryToPostMessage({action: `destroy`});\n    //clear the current content\n    this.slideHolder.innerHTML = ``;\n    $(slideHolder).attr(`data-name`, this.name);\n    $(slideHolder).addClass(`loading`);\n\n    $(slideHolder).off(`load`);\n    $(slideHolder).on(`load`, () => {\n      this.tryToPostMessage({\n        action: `setState`,\n        state: this.state\n      });\n      $(slideHolder).off(`load`);\n    });\n\n    if(src !== $(slideHolder).attr(`data-src`)) {\n      //fetch the html\n      fetch(src)\n        .then(result => result.text())\n        .then(result => $(result))\n        .then($result => {\n          $(slideHolder).html($result.html());\n          $(slideHolder).removeClass(`loading`);\n          cb();\n        })\n        .catch(err => {\n          console.error(err);\n          $(slideHolder).removeClass(`loading`);\n          cb();\n        });\n      $(slideHolder).attr(`data-src`, src);\n    }\n  }\n\n  tryToPostMessage(message) {\n    if(!this.slideHolder)\n    {\n      console.log(`${this.name  } post fail`);\n      return;\n    }\n    //trigger with jquery\n    $(this.slideHolder).trigger(`message-to-slide`, message);\n  }\n\n  setState(state) {\n    this.state = state;\n    this.tryToPostMessage({\n      action: `setState`,\n      state: this.state\n    });\n  }\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvaXNvbW9ycGhpYy1mZXRjaC9mZXRjaC1ucG0tYnJvd3NlcmlmeS5qcyIsIm5vZGVfbW9kdWxlcy93aGF0d2ctZmV0Y2gvZmV0Y2guanMiLCJzcmMvbW9iaWxlL2pzL2NsYXNzZXMvUHJlc2VudGF0aW9uLmpzIiwic3JjL21vYmlsZS9qcy9zY3JpcHQuanMiLCJzcmMvc2hhcmVkL2pzL0NvbnN0YW50cy5qcyIsInNyYy9zaGFyZWQvanMvY2xhc3Nlcy9Nb2JpbGVTZXJ2ZXJCcmlkZ2UuanMiLCJzcmMvc2hhcmVkL2pzL2NsYXNzZXMvUHJlc2VudGF0aW9uLmpzIiwic3JjL3NoYXJlZC9qcy9jbGFzc2VzL1NsaWRlQnJpZGdlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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L0RrQixXIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIHRoZSB3aGF0d2ctZmV0Y2ggcG9seWZpbGwgaW5zdGFsbHMgdGhlIGZldGNoKCkgZnVuY3Rpb25cbi8vIG9uIHRoZSBnbG9iYWwgb2JqZWN0ICh3aW5kb3cgb3Igc2VsZilcbi8vXG4vLyBSZXR1cm4gdGhhdCBhcyB0aGUgZXhwb3J0IGZvciB1c2UgaW4gV2VicGFjaywgQnJvd3NlcmlmeSBldGMuXG5yZXF1aXJlKCd3aGF0d2ctZmV0Y2gnKTtcbm1vZHVsZS5leHBvcnRzID0gc2VsZi5mZXRjaC5iaW5kKHNlbGYpO1xuIiwiKGZ1bmN0aW9uKHNlbGYpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGlmIChzZWxmLmZldGNoKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICB2YXIgc3VwcG9ydCA9IHtcbiAgICBzZWFyY2hQYXJhbXM6ICdVUkxTZWFyY2hQYXJhbXMnIGluIHNlbGYsXG4gICAgaXRlcmFibGU6ICdTeW1ib2wnIGluIHNlbGYgJiYgJ2l0ZXJhdG9yJyBpbiBTeW1ib2wsXG4gICAgYmxvYjogJ0ZpbGVSZWFkZXInIGluIHNlbGYgJiYgJ0Jsb2InIGluIHNlbGYgJiYgKGZ1bmN0aW9uKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgbmV3IEJsb2IoKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuICAgIH0pKCksXG4gICAgZm9ybURhdGE6ICdGb3JtRGF0YScgaW4gc2VsZixcbiAgICBhcnJheUJ1ZmZlcjogJ0FycmF5QnVmZmVyJyBpbiBzZWxmXG4gIH1cblxuICBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlcikge1xuICAgIHZhciB2aWV3Q2xhc3NlcyA9IFtcbiAgICAgICdbb2JqZWN0IEludDhBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgVWludDhBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgVWludDhDbGFtcGVkQXJyYXldJyxcbiAgICAgICdbb2JqZWN0IEludDE2QXJyYXldJyxcbiAgICAgICdbb2JqZWN0IFVpbnQxNkFycmF5XScsXG4gICAgICAnW29iamVjdCBJbnQzMkFycmF5XScsXG4gICAgICAnW29iamVjdCBVaW50MzJBcnJheV0nLFxuICAgICAgJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsXG4gICAgICAnW29iamVjdCBGbG9hdDY0QXJyYXldJ1xuICAgIF1cblxuICAgIHZhciBpc0RhdGFWaWV3ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gb2JqICYmIERhdGFWaWV3LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKG9iailcbiAgICB9XG5cbiAgICB2YXIgaXNBcnJheUJ1ZmZlclZpZXcgPSBBcnJheUJ1ZmZlci5pc1ZpZXcgfHwgZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gb2JqICYmIHZpZXdDbGFzc2VzLmluZGV4T2YoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikpID4gLTFcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBub3JtYWxpemVOYW1lKG5hbWUpIHtcbiAgICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICBuYW1lID0gU3RyaW5nKG5hbWUpXG4gICAgfVxuICAgIGlmICgvW15hLXowLTlcXC0jJCUmJyorLlxcXl9gfH5dL2kudGVzdChuYW1lKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBjaGFyYWN0ZXIgaW4gaGVhZGVyIGZpZWxkIG5hbWUnKVxuICAgIH1cbiAgICByZXR1cm4gbmFtZS50b0xvd2VyQ2FzZSgpXG4gIH1cblxuICBmdW5jdGlvbiBub3JtYWxpemVWYWx1ZSh2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICB2YWx1ZSA9IFN0cmluZyh2YWx1ZSlcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlXG4gIH1cblxuICAvLyBCdWlsZCBhIGRlc3RydWN0aXZlIGl0ZXJhdG9yIGZvciB0aGUgdmFsdWUgbGlzdFxuICBmdW5jdGlvbiBpdGVyYXRvckZvcihpdGVtcykge1xuICAgIHZhciBpdGVyYXRvciA9IHtcbiAgICAgIG5leHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBpdGVtcy5zaGlmdCgpXG4gICAgICAgIHJldHVybiB7ZG9uZTogdmFsdWUgPT09IHVuZGVmaW5lZCwgdmFsdWU6IHZhbHVlfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdXBwb3J0Lml0ZXJhYmxlKSB7XG4gICAgICBpdGVyYXRvcltTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBpdGVyYXRvclxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBpdGVyYXRvclxuICB9XG5cbiAgZnVuY3Rpb24gSGVhZGVycyhoZWFkZXJzKSB7XG4gICAgdGhpcy5tYXAgPSB7fVxuXG4gICAgaWYgKGhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzKSB7XG4gICAgICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIG5hbWUpIHtcbiAgICAgICAgdGhpcy5hcHBlbmQobmFtZSwgdmFsdWUpXG4gICAgICB9LCB0aGlzKVxuICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShoZWFkZXJzKSkge1xuICAgICAgaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKGhlYWRlcikge1xuICAgICAgICB0aGlzLmFwcGVuZChoZWFkZXJbMF0sIGhlYWRlclsxXSlcbiAgICAgIH0sIHRoaXMpXG4gICAgfSBlbHNlIGlmIChoZWFkZXJzKSB7XG4gICAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoZWFkZXJzKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgdGhpcy5hcHBlbmQobmFtZSwgaGVhZGVyc1tuYW1lXSlcbiAgICAgIH0sIHRoaXMpXG4gICAgfVxuICB9XG5cbiAgSGVhZGVycy5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICBuYW1lID0gbm9ybWFsaXplTmFtZShuYW1lKVxuICAgIHZhbHVlID0gbm9ybWFsaXplVmFsdWUodmFsdWUpXG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5tYXBbbmFtZV1cbiAgICB0aGlzLm1hcFtuYW1lXSA9IG9sZFZhbHVlID8gb2xkVmFsdWUrJywnK3ZhbHVlIDogdmFsdWVcbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlWydkZWxldGUnXSA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBkZWxldGUgdGhpcy5tYXBbbm9ybWFsaXplTmFtZShuYW1lKV1cbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBuYW1lID0gbm9ybWFsaXplTmFtZShuYW1lKVxuICAgIHJldHVybiB0aGlzLmhhcyhuYW1lKSA/IHRoaXMubWFwW25hbWVdIDogbnVsbFxuICB9XG5cbiAgSGVhZGVycy5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiB0aGlzLm1hcC5oYXNPd25Qcm9wZXJ0eShub3JtYWxpemVOYW1lKG5hbWUpKVxuICB9XG5cbiAgSGVhZGVycy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICB0aGlzLm1hcFtub3JtYWxpemVOYW1lKG5hbWUpXSA9IG5vcm1hbGl6ZVZhbHVlKHZhbHVlKVxuICB9XG5cbiAgSGVhZGVycy5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aGlzQXJnKSB7XG4gICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzLm1hcCkge1xuICAgICAgaWYgKHRoaXMubWFwLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdGhpcy5tYXBbbmFtZV0sIG5hbWUsIHRoaXMpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgSGVhZGVycy5wcm90b3R5cGUua2V5cyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpdGVtcyA9IFtdXG4gICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7IGl0ZW1zLnB1c2gobmFtZSkgfSlcbiAgICByZXR1cm4gaXRlcmF0b3JGb3IoaXRlbXMpXG4gIH1cblxuICBIZWFkZXJzLnByb3RvdHlwZS52YWx1ZXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbXMgPSBbXVxuICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkgeyBpdGVtcy5wdXNoKHZhbHVlKSB9KVxuICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcylcbiAgfVxuXG4gIEhlYWRlcnMucHJvdG90eXBlLmVudHJpZXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaXRlbXMgPSBbXVxuICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwgbmFtZSkgeyBpdGVtcy5wdXNoKFtuYW1lLCB2YWx1ZV0pIH0pXG4gICAgcmV0dXJuIGl0ZXJhdG9yRm9yKGl0ZW1zKVxuICB9XG5cbiAgaWYgKHN1cHBvcnQuaXRlcmFibGUpIHtcbiAgICBIZWFkZXJzLnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdID0gSGVhZGVycy5wcm90b3R5cGUuZW50cmllc1xuICB9XG5cbiAgZnVuY3Rpb24gY29uc3VtZWQoYm9keSkge1xuICAgIGlmIChib2R5LmJvZHlVc2VkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFR5cGVFcnJvcignQWxyZWFkeSByZWFkJykpXG4gICAgfVxuICAgIGJvZHkuYm9keVVzZWQgPSB0cnVlXG4gIH1cblxuICBmdW5jdGlvbiBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlYWRlci5yZXN1bHQpXG4gICAgICB9XG4gICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVhZGVyLmVycm9yKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBmdW5jdGlvbiByZWFkQmxvYkFzQXJyYXlCdWZmZXIoYmxvYikge1xuICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gICAgdmFyIHByb21pc2UgPSBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKVxuICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKVxuICAgIHJldHVybiBwcm9taXNlXG4gIH1cblxuICBmdW5jdGlvbiByZWFkQmxvYkFzVGV4dChibG9iKSB7XG4gICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcbiAgICB2YXIgcHJvbWlzZSA9IGZpbGVSZWFkZXJSZWFkeShyZWFkZXIpXG4gICAgcmVhZGVyLnJlYWRBc1RleHQoYmxvYilcbiAgICByZXR1cm4gcHJvbWlzZVxuICB9XG5cbiAgZnVuY3Rpb24gcmVhZEFycmF5QnVmZmVyQXNUZXh0KGJ1Zikge1xuICAgIHZhciB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYnVmKVxuICAgIHZhciBjaGFycyA9IG5ldyBBcnJheSh2aWV3Lmxlbmd0aClcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgY2hhcnNbaV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHZpZXdbaV0pXG4gICAgfVxuICAgIHJldHVybiBjaGFycy5qb2luKCcnKVxuICB9XG5cbiAgZnVuY3Rpb24gYnVmZmVyQ2xvbmUoYnVmKSB7XG4gICAgaWYgKGJ1Zi5zbGljZSkge1xuICAgICAgcmV0dXJuIGJ1Zi5zbGljZSgwKVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgdmlldyA9IG5ldyBVaW50OEFycmF5KGJ1Zi5ieXRlTGVuZ3RoKVxuICAgICAgdmlldy5zZXQobmV3IFVpbnQ4QXJyYXkoYnVmKSlcbiAgICAgIHJldHVybiB2aWV3LmJ1ZmZlclxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIEJvZHkoKSB7XG4gICAgdGhpcy5ib2R5VXNlZCA9IGZhbHNlXG5cbiAgICB0aGlzLl9pbml0Qm9keSA9IGZ1bmN0aW9uKGJvZHkpIHtcbiAgICAgIHRoaXMuX2JvZHlJbml0ID0gYm9keVxuICAgICAgaWYgKCFib2R5KSB7XG4gICAgICAgIHRoaXMuX2JvZHlUZXh0ID0gJydcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRoaXMuX2JvZHlUZXh0ID0gYm9keVxuICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LmJsb2IgJiYgQmxvYi5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkge1xuICAgICAgICB0aGlzLl9ib2R5QmxvYiA9IGJvZHlcbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5mb3JtRGF0YSAmJiBGb3JtRGF0YS5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkge1xuICAgICAgICB0aGlzLl9ib2R5Rm9ybURhdGEgPSBib2R5XG4gICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkge1xuICAgICAgICB0aGlzLl9ib2R5VGV4dCA9IGJvZHkudG9TdHJpbmcoKVxuICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LmFycmF5QnVmZmVyICYmIHN1cHBvcnQuYmxvYiAmJiBpc0RhdGFWaWV3KGJvZHkpKSB7XG4gICAgICAgIHRoaXMuX2JvZHlBcnJheUJ1ZmZlciA9IGJ1ZmZlckNsb25lKGJvZHkuYnVmZmVyKVxuICAgICAgICAvLyBJRSAxMC0xMSBjYW4ndCBoYW5kbGUgYSBEYXRhVmlldyBib2R5LlxuICAgICAgICB0aGlzLl9ib2R5SW5pdCA9IG5ldyBCbG9iKFt0aGlzLl9ib2R5QXJyYXlCdWZmZXJdKVxuICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LmFycmF5QnVmZmVyICYmIChBcnJheUJ1ZmZlci5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSB8fCBpc0FycmF5QnVmZmVyVmlldyhib2R5KSkpIHtcbiAgICAgICAgdGhpcy5fYm9keUFycmF5QnVmZmVyID0gYnVmZmVyQ2xvbmUoYm9keSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigndW5zdXBwb3J0ZWQgQm9keUluaXQgdHlwZScpXG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5oZWFkZXJzLmdldCgnY29udGVudC10eXBlJykpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBib2R5ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoJ2NvbnRlbnQtdHlwZScsICd0ZXh0L3BsYWluO2NoYXJzZXQ9VVRGLTgnKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlCbG9iICYmIHRoaXMuX2JvZHlCbG9iLnR5cGUpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCdjb250ZW50LXR5cGUnLCB0aGlzLl9ib2R5QmxvYi50eXBlKVxuICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkge1xuICAgICAgICAgIHRoaXMuaGVhZGVycy5zZXQoJ2NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD1VVEYtOCcpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3VwcG9ydC5ibG9iKSB7XG4gICAgICB0aGlzLmJsb2IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJlamVjdGVkID0gY29uc3VtZWQodGhpcylcbiAgICAgICAgaWYgKHJlamVjdGVkKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdGVkXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fYm9keUJsb2IpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlCbG9iKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IEJsb2IoW3RoaXMuX2JvZHlBcnJheUJ1ZmZlcl0pKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlGb3JtRGF0YSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignY291bGQgbm90IHJlYWQgRm9ybURhdGEgYm9keSBhcyBibG9iJylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBCbG9iKFt0aGlzLl9ib2R5VGV4dF0pKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYXJyYXlCdWZmZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikge1xuICAgICAgICAgIHJldHVybiBjb25zdW1lZCh0aGlzKSB8fCBQcm9taXNlLnJlc29sdmUodGhpcy5fYm9keUFycmF5QnVmZmVyKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB0aGlzLmJsb2IoKS50aGVuKHJlYWRCbG9iQXNBcnJheUJ1ZmZlcilcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMudGV4dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHJlamVjdGVkID0gY29uc3VtZWQodGhpcylcbiAgICAgIGlmIChyZWplY3RlZCkge1xuICAgICAgICByZXR1cm4gcmVqZWN0ZWRcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX2JvZHlCbG9iKSB7XG4gICAgICAgIHJldHVybiByZWFkQmxvYkFzVGV4dCh0aGlzLl9ib2R5QmxvYilcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUFycmF5QnVmZmVyKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVhZEFycmF5QnVmZmVyQXNUZXh0KHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikpXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlGb3JtRGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvdWxkIG5vdCByZWFkIEZvcm1EYXRhIGJvZHkgYXMgdGV4dCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlUZXh0KVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdXBwb3J0LmZvcm1EYXRhKSB7XG4gICAgICB0aGlzLmZvcm1EYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHQoKS50aGVuKGRlY29kZSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmpzb24gPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnRleHQoKS50aGVuKEpTT04ucGFyc2UpXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIC8vIEhUVFAgbWV0aG9kcyB3aG9zZSBjYXBpdGFsaXphdGlvbiBzaG91bGQgYmUgbm9ybWFsaXplZFxuICB2YXIgbWV0aG9kcyA9IFsnREVMRVRFJywgJ0dFVCcsICdIRUFEJywgJ09QVElPTlMnLCAnUE9TVCcsICdQVVQnXVxuXG4gIGZ1bmN0aW9uIG5vcm1hbGl6ZU1ldGhvZChtZXRob2QpIHtcbiAgICB2YXIgdXBjYXNlZCA9IG1ldGhvZC50b1VwcGVyQ2FzZSgpXG4gICAgcmV0dXJuIChtZXRob2RzLmluZGV4T2YodXBjYXNlZCkgPiAtMSkgPyB1cGNhc2VkIDogbWV0aG9kXG4gIH1cblxuICBmdW5jdGlvbiBSZXF1ZXN0KGlucHV0LCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge31cbiAgICB2YXIgYm9keSA9IG9wdGlvbnMuYm9keVxuXG4gICAgaWYgKGlucHV0IGluc3RhbmNlb2YgUmVxdWVzdCkge1xuICAgICAgaWYgKGlucHV0LmJvZHlVc2VkKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FscmVhZHkgcmVhZCcpXG4gICAgICB9XG4gICAgICB0aGlzLnVybCA9IGlucHV0LnVybFxuICAgICAgdGhpcy5jcmVkZW50aWFscyA9IGlucHV0LmNyZWRlbnRpYWxzXG4gICAgICBpZiAoIW9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycyhpbnB1dC5oZWFkZXJzKVxuICAgICAgfVxuICAgICAgdGhpcy5tZXRob2QgPSBpbnB1dC5tZXRob2RcbiAgICAgIHRoaXMubW9kZSA9IGlucHV0Lm1vZGVcbiAgICAgIGlmICghYm9keSAmJiBpbnB1dC5fYm9keUluaXQgIT0gbnVsbCkge1xuICAgICAgICBib2R5ID0gaW5wdXQuX2JvZHlJbml0XG4gICAgICAgIGlucHV0LmJvZHlVc2VkID0gdHJ1ZVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVybCA9IFN0cmluZyhpbnB1dClcbiAgICB9XG5cbiAgICB0aGlzLmNyZWRlbnRpYWxzID0gb3B0aW9ucy5jcmVkZW50aWFscyB8fCB0aGlzLmNyZWRlbnRpYWxzIHx8ICdvbWl0J1xuICAgIGlmIChvcHRpb25zLmhlYWRlcnMgfHwgIXRoaXMuaGVhZGVycykge1xuICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMob3B0aW9ucy5oZWFkZXJzKVxuICAgIH1cbiAgICB0aGlzLm1ldGhvZCA9IG5vcm1hbGl6ZU1ldGhvZChvcHRpb25zLm1ldGhvZCB8fCB0aGlzLm1ldGhvZCB8fCAnR0VUJylcbiAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgdGhpcy5tb2RlIHx8IG51bGxcbiAgICB0aGlzLnJlZmVycmVyID0gbnVsbFxuXG4gICAgaWYgKCh0aGlzLm1ldGhvZCA9PT0gJ0dFVCcgfHwgdGhpcy5tZXRob2QgPT09ICdIRUFEJykgJiYgYm9keSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQm9keSBub3QgYWxsb3dlZCBmb3IgR0VUIG9yIEhFQUQgcmVxdWVzdHMnKVxuICAgIH1cbiAgICB0aGlzLl9pbml0Qm9keShib2R5KVxuICB9XG5cbiAgUmVxdWVzdC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFJlcXVlc3QodGhpcywgeyBib2R5OiB0aGlzLl9ib2R5SW5pdCB9KVxuICB9XG5cbiAgZnVuY3Rpb24gZGVjb2RlKGJvZHkpIHtcbiAgICB2YXIgZm9ybSA9IG5ldyBGb3JtRGF0YSgpXG4gICAgYm9keS50cmltKCkuc3BsaXQoJyYnKS5mb3JFYWNoKGZ1bmN0aW9uKGJ5dGVzKSB7XG4gICAgICBpZiAoYnl0ZXMpIHtcbiAgICAgICAgdmFyIHNwbGl0ID0gYnl0ZXMuc3BsaXQoJz0nKVxuICAgICAgICB2YXIgbmFtZSA9IHNwbGl0LnNoaWZ0KCkucmVwbGFjZSgvXFwrL2csICcgJylcbiAgICAgICAgdmFyIHZhbHVlID0gc3BsaXQuam9pbignPScpLnJlcGxhY2UoL1xcKy9nLCAnICcpXG4gICAgICAgIGZvcm0uYXBwZW5kKGRlY29kZVVSSUNvbXBvbmVudChuYW1lKSwgZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKSlcbiAgICAgIH1cbiAgICB9KVxuICAgIHJldHVybiBmb3JtXG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMocmF3SGVhZGVycykge1xuICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKVxuICAgIHJhd0hlYWRlcnMuc3BsaXQoL1xccj9cXG4vKS5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHZhciBwYXJ0cyA9IGxpbmUuc3BsaXQoJzonKVxuICAgICAgdmFyIGtleSA9IHBhcnRzLnNoaWZ0KCkudHJpbSgpXG4gICAgICBpZiAoa2V5KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHBhcnRzLmpvaW4oJzonKS50cmltKClcbiAgICAgICAgaGVhZGVycy5hcHBlbmQoa2V5LCB2YWx1ZSlcbiAgICAgIH1cbiAgICB9KVxuICAgIHJldHVybiBoZWFkZXJzXG4gIH1cblxuICBCb2R5LmNhbGwoUmVxdWVzdC5wcm90b3R5cGUpXG5cbiAgZnVuY3Rpb24gUmVzcG9uc2UoYm9keUluaXQsIG9wdGlvbnMpIHtcbiAgICBpZiAoIW9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSB7fVxuICAgIH1cblxuICAgIHRoaXMudHlwZSA9ICdkZWZhdWx0J1xuICAgIHRoaXMuc3RhdHVzID0gJ3N0YXR1cycgaW4gb3B0aW9ucyA/IG9wdGlvbnMuc3RhdHVzIDogMjAwXG4gICAgdGhpcy5vayA9IHRoaXMuc3RhdHVzID49IDIwMCAmJiB0aGlzLnN0YXR1cyA8IDMwMFxuICAgIHRoaXMuc3RhdHVzVGV4dCA9ICdzdGF0dXNUZXh0JyBpbiBvcHRpb25zID8gb3B0aW9ucy5zdGF0dXNUZXh0IDogJ09LJ1xuICAgIHRoaXMuaGVhZGVycyA9IG5ldyBIZWFkZXJzKG9wdGlvbnMuaGVhZGVycylcbiAgICB0aGlzLnVybCA9IG9wdGlvbnMudXJsIHx8ICcnXG4gICAgdGhpcy5faW5pdEJvZHkoYm9keUluaXQpXG4gIH1cblxuICBCb2R5LmNhbGwoUmVzcG9uc2UucHJvdG90eXBlKVxuXG4gIFJlc3BvbnNlLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UodGhpcy5fYm9keUluaXQsIHtcbiAgICAgIHN0YXR1czogdGhpcy5zdGF0dXMsXG4gICAgICBzdGF0dXNUZXh0OiB0aGlzLnN0YXR1c1RleHQsXG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh0aGlzLmhlYWRlcnMpLFxuICAgICAgdXJsOiB0aGlzLnVybFxuICAgIH0pXG4gIH1cblxuICBSZXNwb25zZS5lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciByZXNwb25zZSA9IG5ldyBSZXNwb25zZShudWxsLCB7c3RhdHVzOiAwLCBzdGF0dXNUZXh0OiAnJ30pXG4gICAgcmVzcG9uc2UudHlwZSA9ICdlcnJvcidcbiAgICByZXR1cm4gcmVzcG9uc2VcbiAgfVxuXG4gIHZhciByZWRpcmVjdFN0YXR1c2VzID0gWzMwMSwgMzAyLCAzMDMsIDMwNywgMzA4XVxuXG4gIFJlc3BvbnNlLnJlZGlyZWN0ID0gZnVuY3Rpb24odXJsLCBzdGF0dXMpIHtcbiAgICBpZiAocmVkaXJlY3RTdGF0dXNlcy5pbmRleE9mKHN0YXR1cykgPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignSW52YWxpZCBzdGF0dXMgY29kZScpXG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7c3RhdHVzOiBzdGF0dXMsIGhlYWRlcnM6IHtsb2NhdGlvbjogdXJsfX0pXG4gIH1cblxuICBzZWxmLkhlYWRlcnMgPSBIZWFkZXJzXG4gIHNlbGYuUmVxdWVzdCA9IFJlcXVlc3RcbiAgc2VsZi5SZXNwb25zZSA9IFJlc3BvbnNlXG5cbiAgc2VsZi5mZXRjaCA9IGZ1bmN0aW9uKGlucHV0LCBpbml0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgUmVxdWVzdChpbnB1dCwgaW5pdClcbiAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKVxuXG4gICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgIHN0YXR1czogeGhyLnN0YXR1cyxcbiAgICAgICAgICBzdGF0dXNUZXh0OiB4aHIuc3RhdHVzVGV4dCxcbiAgICAgICAgICBoZWFkZXJzOiBwYXJzZUhlYWRlcnMoeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpIHx8ICcnKVxuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMudXJsID0gJ3Jlc3BvbnNlVVJMJyBpbiB4aHIgPyB4aHIucmVzcG9uc2VVUkwgOiBvcHRpb25zLmhlYWRlcnMuZ2V0KCdYLVJlcXVlc3QtVVJMJylcbiAgICAgICAgdmFyIGJvZHkgPSAncmVzcG9uc2UnIGluIHhociA/IHhoci5yZXNwb25zZSA6IHhoci5yZXNwb25zZVRleHRcbiAgICAgICAgcmVzb2x2ZShuZXcgUmVzcG9uc2UoYm9keSwgb3B0aW9ucykpXG4gICAgICB9XG5cbiAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChuZXcgVHlwZUVycm9yKCdOZXR3b3JrIHJlcXVlc3QgZmFpbGVkJykpXG4gICAgICB9XG5cbiAgICAgIHhoci5vbnRpbWVvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KG5ldyBUeXBlRXJyb3IoJ05ldHdvcmsgcmVxdWVzdCBmYWlsZWQnKSlcbiAgICAgIH1cblxuICAgICAgeGhyLm9wZW4ocmVxdWVzdC5tZXRob2QsIHJlcXVlc3QudXJsLCB0cnVlKVxuXG4gICAgICBpZiAocmVxdWVzdC5jcmVkZW50aWFscyA9PT0gJ2luY2x1ZGUnKSB7XG4gICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlXG4gICAgICB9XG5cbiAgICAgIGlmICgncmVzcG9uc2VUeXBlJyBpbiB4aHIgJiYgc3VwcG9ydC5ibG9iKSB7XG4gICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnYmxvYidcbiAgICAgIH1cblxuICAgICAgcmVxdWVzdC5oZWFkZXJzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIG5hbWUpIHtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIobmFtZSwgdmFsdWUpXG4gICAgICB9KVxuXG4gICAgICB4aHIuc2VuZCh0eXBlb2YgcmVxdWVzdC5fYm9keUluaXQgPT09ICd1bmRlZmluZWQnID8gbnVsbCA6IHJlcXVlc3QuX2JvZHlJbml0KVxuICAgIH0pXG4gIH1cbiAgc2VsZi5mZXRjaC5wb2x5ZmlsbCA9IHRydWVcbn0pKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB0aGlzKTtcbiIsImltcG9ydCB7Q29uc3RhbnRzfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvanMvQ29uc3RhbnRzJztcbmltcG9ydCBQcmVzZW50YXRpb25CYXNlIGZyb20gJy4uLy4uLy4uL3NoYXJlZC9qcy9jbGFzc2VzL1ByZXNlbnRhdGlvbic7XG5pbXBvcnQgTW9iaWxlU2VydmVyQnJpZGdlIGZyb20gJy4uLy4uLy4uL3NoYXJlZC9qcy9jbGFzc2VzL01vYmlsZVNlcnZlckJyaWRnZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByZXNlbnRhdGlvbiBleHRlbmRzIFByZXNlbnRhdGlvbkJhc2V7XG5cbiAgY29uc3RydWN0b3IoZGF0YSwgcm9sZSwgc2V0dGluZ3MpIHtcbiAgICBzdXBlcihkYXRhLCByb2xlLCBzZXR0aW5ncyk7XG4gICAgdGhpcy4kb3ZlcmxheSA9ICQoYCNvdmVybGF5YCk7XG4gIH1cblxuICBjcmVhdGVNb2JpbGVTZXJ2ZXJCcmlkZ2UoKSB7XG4gICAgcmV0dXJuIG5ldyBNb2JpbGVTZXJ2ZXJCcmlkZ2UodGhpcywgdGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICBoYW5kbGVNb2JpbGVTZXJ2ZXJNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICBpZighbWVzc2FnZS5jb250ZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmKG1lc3NhZ2UuY29udGVudC5hY3Rpb24gPT09IGBzZXRDdXJyZW50U2xpZGVJbmRleGApIHtcbiAgICAgIHRoaXMuc2V0Q3VycmVudFNsaWRlSW5kZXgobWVzc2FnZS5jb250ZW50LmN1cnJlbnRTbGlkZUluZGV4KTtcbiAgICB9IGVsc2UgaWYobWVzc2FnZS5jb250ZW50LmFjdGlvbiA9PT0gQ29uc3RhbnRzLkJMSU5LKSB7XG4gICAgICB0aGlzLmJsaW5rKG1lc3NhZ2UuY29udGVudC50ZXh0LCBtZXNzYWdlLmNvbnRlbnQuYmFja2dyb3VuZENvbG9yKTtcbiAgICB9XG4gIH1cblxuICBzZXRDdXJyZW50U2xpZGVJbmRleChpbmRleCkge1xuICAgIHN1cGVyLnNldEN1cnJlbnRTbGlkZUluZGV4KGluZGV4KTtcbiAgICBpZih0aGlzLiRvdmVybGF5KSB7XG4gICAgICB0aGlzLiRvdmVybGF5LnJlbW92ZUNsYXNzKGBhY3RpdmVgKTtcbiAgICB9XG4gICAgaWYodGhpcy5ibGlua0ludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuYmxpbmtJbnRlcnZhbCk7XG4gICAgfVxuICB9XG5cbiAgYmxpbmsodGV4dCwgYmFja2dyb3VuZENvbG9yKSB7XG4gICAgLy9vdmVybGF5IGltcG9ydGFudCwgYmxpbmtpbmcgdGV4dFxuICAgIHRoaXMuJG92ZXJsYXkuZmluZChgLmNvbnRlbnRgKS5odG1sKHRleHQpO1xuICAgIHRoaXMuJG92ZXJsYXkuYWRkQ2xhc3MoYGFjdGl2ZWApO1xuICAgIGlmKHRoaXMuYmxpbmtJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmJsaW5rSW50ZXJ2YWwpO1xuICAgIH1cbiAgICB0aGlzLmJsaW5rSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLmJsaW5rVG9nZ2xlLmJpbmQodGhpcywgYmFja2dyb3VuZENvbG9yKSwgNTAwKTtcbiAgfVxuXG4gIGJsaW5rVG9nZ2xlKGJhY2tncm91bmRDb2xvcikge1xuICAgIHRoaXMuJG92ZXJsYXkudG9nZ2xlQ2xhc3MoYGJsaW5rLW9uYCk7XG4gICAgaWYodGhpcy4kb3ZlcmxheS5oYXNDbGFzcyhgYmxpbmstb25gKSkge1xuICAgICAgdGhpcy4kb3ZlcmxheS5jc3MoYGJhY2tncm91bmQtY29sb3JgLCBiYWNrZ3JvdW5kQ29sb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiRvdmVybGF5LmNzcyhgYmFja2dyb3VuZC1jb2xvcmAsIGBgKTtcbiAgICB9XG4gIH1cblxufVxuIiwiaW1wb3J0IFByZXNlbnRhdGlvbiBmcm9tICcuL2NsYXNzZXMvUHJlc2VudGF0aW9uJztcbmltcG9ydCBmZXRjaCBmcm9tICdpc29tb3JwaGljLWZldGNoJztcblxuKCgpID0+IHtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0ge1xuICAgICAgcHJlc2VudGF0aW9uUGF0aDogYC9gLFxuICAgICAgbW9iaWxlU2VydmVyVXJsOiBgYFxuICAgIH07XG4gICAgLy9nZXQgc2xpZGVzIGJ5IHhtbGh0dHByZXF1ZXN0XG4gICAgZmV0Y2goYC9kYXRhLmpzb24/dD0keyAgRGF0ZS5ub3coKX1gKVxuICAgICAgLnRoZW4oZGF0YSA9PiBkYXRhLmpzb24oKSlcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICBuZXcgUHJlc2VudGF0aW9uKGRhdGEsIGBtb2JpbGVgLCBzZXR0aW5ncyk7XG4gICAgICB9KTtcbiAgfTtcblxuICBpbml0KCk7XG59KSgpO1xuIiwiZXhwb3J0IGNvbnN0IENvbnN0YW50cyA9IHtcbiAgR09fVE9fUFJFVklPVVNfU0xJREU6IGBnb1RvUHJldmlvdXNTbGlkZWAsXG4gIEdPX1RPX05FWFRfU0xJREU6IGBnb1RvTmV4dFNsaWRlYCxcbiAgU0VUX1NMSURFUzogYHNldFNsaWRlc2AsXG4gIFNFVF9DVVJSRU5UX1NMSURFX0lOREVYOiBgc2V0Q3VycmVudFNsaWRlSW5kZXhgLFxuXG4gIE1FU1NBR0U6IGBtZXNzYWdlYCxcbiAgU09DS0VUX1NFTkQ6IGBzb2NrZXRTZW5kYCxcbiAgU09DS0VUX1JFQ0VJVkU6IGBzb2NrZXRSZWNlaXZlYCxcbiAgSk9JTl9TTElERV9ST09NOiBgam9pblNsaWRlUm9vbWAsXG4gIExFQVZFX1NMSURFX1JPT006IGBsZWF2ZVNsaWRlUm9vbWAsXG5cbiAgUk9MRV9QUkVTRU5UQVRJT046IGBwcmVzZW50YXRpb25gLFxuICBST0xFX01PQklMRTogYG1vYmlsZWAsXG5cbiAgU1RBVEVfQUNUSVZFOiBgYWN0aXZlYCxcbiAgU1RBVEVfSU5BQ1RJVkU6IGBpbmFjdGl2ZWAsXG5cbiAgU0VUX1NVQlNUQVRFOiBgc2V0U3Vic3RhdGVgLFxuXG4gIENISUxEX0FQUF9TQVZFX0NPREU6IGBjaGlsZEFwcFNhdmVDb2RlYCxcbiAgQ0hJTERfQVBQX1JVTl9DT0RFOiBgY2hpbGRBcHBSdW5Db2RlYCxcbiAgQ0hJTERfQVBQX1NURE9VVF9EQVRBOiBgY2hpbGRBcHBTdGRvdXREYXRhYCxcbiAgQ0hJTERfQVBQX1NUREVSUl9EQVRBOiBgY2hpbGRBcHBTdGRlcnJEYXRhYCxcblxuICBPUEVOX0NPTU1BTkRfTElORTogYG9wZW5Db21tYW5kTGluZWAsXG4gIE9QRU5fQ0FNRVJBOiBgb3BlbkNhbWVyYWAsXG5cbiAgQkxJTks6IGBibGlua2AsXG5cbiAgSEVBUlRfUkFURV9QT0xBUjogYGhlYXJ0UmF0ZVBvbGFyYCxcblxuICBTRVRfVEVBTTogYHNldFRlYW1gLFxuICBVUERBVEVfTU9USU9OOiBgdXBkYXRlTW90aW9uYCxcblxuICBZT1VfV0lOOiBgeW91V2luYCxcbiAgWU9VX0xPU0U6IGB5b3VMb3NlYCxcblxuICBTSEFLRV9ZT1VSX1BIT05FU19JTlRSTzogYHNoYWtlWW91clBob25lc0ludHJvYCxcbiAgU0hBS0VfWU9VUl9QSE9ORVNfR0FNRTogYHNoYWtlWW91clBob25lc0dhbWVgLFxuICBTSEFLRV9ZT1VSX1BIT05FU19GSU5JU0hFRDogYHNoYWtlWW91clBob25lc0ZpbmlzaGVkYCxcblxuICBTSEFLRV9ZT1VSX1BIT05FU19DTElFTlRfQURERUQ6IGBzaGFrZVlvdXJQaG9uZXNDbGllbnRBZGRlZGAsXG4gIFNIQUtFX1lPVVJfUEhPTkVTX0NMSUVOVF9SRU1PVkVEOiBgc2hha2VZb3VyUGhvbmVzQ2xpZW50UmVtb3ZlZGAsXG4gIFNIQUtFX1lPVVJfUEhPTkVTX0NMSUVOVF9MSVNUOiBgc2hha2VZb3VyUGhvbmVzQ2xpZW50TGlzdGAsXG4gIFNIQUtFX1lPVVJfUEhPTkVTX0NMSUVOVF9VUERBVEU6IGBzaGFrZVlvdXJQaG9uZXNDbGllbnRVcGRhdGVgXG59O1xuIiwiaW1wb3J0IGZldGNoIGZyb20gJ2lzb21vcnBoaWMtZmV0Y2gnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2JpbGVTZXJ2ZXJCcmlkZ2Uge1xuXG4gIGNvbnN0cnVjdG9yKHByZXNlbnRhdGlvbiwgc2V0dGluZ3MpIHtcbiAgICB0aGlzLnByZXNlbnRhdGlvbiA9IHByZXNlbnRhdGlvbjtcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgdGhpcy5jb25uZWN0KCk7XG4gIH1cblxuICBjb25uZWN0KCkge1xuICAgIGlmICghdGhpcy5zZXR0aW5ncy5tb2JpbGVTZXJ2ZXJVcmwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coYE1vYmlsZVNlcnZlckJyaWRnZS5jb25uZWN0YCk7XG4gICAgLy9jb25zb2xlLndhcm4oJ01vYmlsZVNlcnZlckJyaWRnZSBkaXNhYmxlZCcpO1xuICAgIC8vcmV0dXJuO1xuICAgIC8vcG9zdCB0byB0aGUgYXBpXG4gICAgZmV0Y2goYCR7dGhpcy5zZXR0aW5ncy5tb2JpbGVTZXJ2ZXJVcmx9L2xvZ2luYCwge1xuICAgICAgbWV0aG9kOiBgUE9TVGAsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh0aGlzLmdldExvZ2luQ3JlZGVudGlhbHMoKSksXG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7J0NvbnRlbnQtVHlwZSc6IGBhcHBsaWNhdGlvbi9qc29uYH0pXG4gICAgfSlcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgLnRoZW4ocmVzdWx0ID0+IHRoaXMubG9naW5IYW5kbGVyKHJlc3VsdCkpXG4gICAgLmNhdGNoKCgpID0+IHtcbiAgICAgIC8vcmV0cnkgYWZ0ZXIgb25lIHNlY29uZFxuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmNvbm5lY3QoKSwgMTAwMCk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRMb2dpbkNyZWRlbnRpYWxzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBlbWFpbDogdGhpcy5zZXR0aW5ncy5tb2JpbGVTZXJ2ZXJVc2VybmFtZSxcbiAgICAgIHBhc3N3b3JkOiB0aGlzLnNldHRpbmdzLm1vYmlsZVNlcnZlclBhc3N3b3JkLFxuICAgIH07XG4gIH1cblxuICBsb2dpbkhhbmRsZXIocmVzdWx0KSB7XG4gICAgdGhpcy50b2tlbiA9IHJlc3VsdC50b2tlbjtcbiAgICB0aGlzLnNvY2tldCA9IGlvKHRoaXMuc2V0dGluZ3MubW9iaWxlU2VydmVyVXJsLCB7XG4gICAgICBxdWVyeTogYHRva2VuPSR7ICB0aGlzLnRva2VufWAsXG4gICAgICByZWNvbm5lY3Rpb246IGZhbHNlLFxuICAgICAgZm9yY2VOZXc6IHRydWVcbiAgICB9KTtcbiAgICB0aGlzLnNvY2tldC5vbihgY29ubmVjdGAsIHRoaXMuc29ja2V0Q29ubmVjdEhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5zb2NrZXQub24oYGRpc2Nvbm5lY3RgLCB0aGlzLnNvY2tldERpc2Nvbm5lY3RIYW5kbGVyLmJpbmQodGhpcykpO1xuICAgIHRoaXMuc29ja2V0Lm9uKGBtZXNzYWdlYCwgdGhpcy5zb2NrZXRNZXNzYWdlSGFuZGxlci5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHNvY2tldENvbm5lY3RIYW5kbGVyKCkge1xuICAgIGNvbnNvbGUubG9nKGBNb2JpbGVTZXJ2ZXJCcmlkZ2Uuc29ja2V0Q29ubmVjdEhhbmRsZXJgKTtcbiAgICB0aGlzLnByZXNlbnRhdGlvbi5tb2JpbGVTZXJ2ZXJCcmlkZ2VDb25uZWN0ZWQoKTtcbiAgfVxuXG4gIHNvY2tldERpc2Nvbm5lY3RIYW5kbGVyKCkge1xuICAgIHRoaXMuY29ubmVjdCgpO1xuICB9XG5cbiAgdHJ5VG9TZW5kKCkge1xuICAgIGlmKHRoaXMuc29ja2V0KSB7XG4gICAgICB0aGlzLnNvY2tldC5lbWl0LmFwcGx5KHRoaXMuc29ja2V0LCBhcmd1bWVudHMpO1xuICAgIH1cbiAgfVxuXG4gIHNvY2tldE1lc3NhZ2VIYW5kbGVyKG1lc3NhZ2UpIHtcbiAgICB0aGlzLnByZXNlbnRhdGlvbi5tb2JpbGVTZXJ2ZXJNZXNzYWdlSGFuZGxlcihtZXNzYWdlKTtcbiAgfVxufVxuIiwiaW1wb3J0IHtDb25zdGFudHN9IGZyb20gJy4uL0NvbnN0YW50cyc7XG5pbXBvcnQgU2xpZGVCcmlkZ2UgZnJvbSAnLi9TbGlkZUJyaWRnZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByZXNlbnRhdGlvbiB7XG4gIC8qXG4gICAqIGRhdGE6IGpzb24gb2JqZWN0IHdpdGggc2xpZGVzIGFycmF5IHByb3BlcnR5XG4gICAqIHJvbGU6IG1vYmlsZSBvciBwcmVzZW50YXRpb25cbiAgICovXG4gIGNvbnN0cnVjdG9yKGRhdGEsIHJvbGUsIHNldHRpbmdzKSB7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB0aGlzLnJvbGUgPSByb2xlO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAkKGAjcHJlc2VudGF0aW9uYCkuYXR0cihgZGF0YS1wcmVzZW50YXRpb24tc2V0dGluZ3NgLCBKU09OLnN0cmluZ2lmeShzZXR0aW5ncykpO1xuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAtMTtcbiAgICB0aGlzLnNsaWRlSG9sZGVycyA9IFtdO1xuICAgIHRoaXMubnVtU2xpZGVIb2xkZXJzID0gMztcbiAgICB0aGlzLnNsaWRlQnJpZGdlcyA9IFtdO1xuICAgIHRoaXMuc2xpZGVCcmlkZ2VzQnlTbGlkZU5hbWUgPSB7fTtcblxuICAgIHRoaXMuY3JlYXRlU2xpZGVIb2xkZXJzKCk7XG4gICAgdGhpcy5jcmVhdGVTbGlkZUJyaWRnZXModGhpcy5kYXRhKTtcblxuICAgIHRoaXMubW9iaWxlU2VydmVyQnJpZGdlID0gdGhpcy5jcmVhdGVNb2JpbGVTZXJ2ZXJCcmlkZ2UoKTtcbiAgICB0aGlzLnN0YXJ0TGlzdGVuaW5nRm9yTWVzc2FnZXMoKTtcblxuICAgIHRoaXMuc2V0Q3VycmVudFNsaWRlSW5kZXgoMCk7XG4gIH1cblxuICBzdGFydExpc3RlbmluZ0Zvck1lc3NhZ2VzKCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKGBtZXNzYWdlYCwgdGhpcy5zbGlkZU1lc3NhZ2VIYW5kbGVyLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgfVxuXG4gIGNyZWF0ZVNsaWRlSG9sZGVycygpIHtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1TbGlkZUhvbGRlcnM7IGkrKykge1xuICAgICAgY29uc3QgJHNsaWRlSG9sZGVyID0gJChgPGRpdiBjbGFzcz1cInNsaWRlLWZyYW1lXCIgLz5gKTtcbiAgICAgIHRoaXMuc2xpZGVIb2xkZXJzLnB1c2goJHNsaWRlSG9sZGVyKTtcbiAgICAgICQoYCNwcmVzZW50YXRpb25gKS5hcHBlbmQoJHNsaWRlSG9sZGVyKTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVTbGlkZUJyaWRnZXMoZGF0YSkge1xuICAgIGNvbnN0IG51bVNsaWRlcyA9IGRhdGEuc2xpZGVzLmxlbmd0aDtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgbnVtU2xpZGVzOyBpKyspIHtcbiAgICAgIGNvbnN0IHNsaWRlQnJpZGdlID0gdGhpcy5jcmVhdGVTbGlkZUJyaWRnZShkYXRhLnNsaWRlc1tpXSk7XG4gICAgICB0aGlzLnNsaWRlQnJpZGdlcy5wdXNoKHNsaWRlQnJpZGdlKTtcbiAgICAgIHRoaXMuc2xpZGVCcmlkZ2VzQnlTbGlkZU5hbWVbc2xpZGVCcmlkZ2UubmFtZV0gPSBzbGlkZUJyaWRnZTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVTbGlkZUJyaWRnZShzbGlkZSkge1xuICAgIHJldHVybiBuZXcgU2xpZGVCcmlkZ2Uoc2xpZGUpO1xuICB9XG5cbiAgc2xpZGVNZXNzYWdlSGFuZGxlcihldmVudCkge1xuICAgIGlmKCFldmVudC5kYXRhKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN3aXRjaChldmVudC5kYXRhLmFjdGlvbikge1xuICAgIGNhc2UgQ29uc3RhbnRzLlNPQ0tFVF9TRU5EOlxuICAgICAgaWYodGhpcy5tb2JpbGVTZXJ2ZXJCcmlkZ2UpIHtcbiAgICAgICAgdGhpcy5tb2JpbGVTZXJ2ZXJCcmlkZ2UudHJ5VG9TZW5kKENvbnN0YW50cy5NRVNTQUdFLCBldmVudC5kYXRhLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgbW9iaWxlU2VydmVyQnJpZGdlQ29ubmVjdGVkKCkge1xuICAgIC8vam9pbiB0aGUgcm9vbXMgb2YgdGhlIHNsaWRlSG9sZGVyc1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm51bVNsaWRlSG9sZGVyczsgaSsrKSB7XG4gICAgICB0aGlzLm1vYmlsZVNlcnZlckJyaWRnZS50cnlUb1NlbmQoQ29uc3RhbnRzLkpPSU5fU0xJREVfUk9PTSwgJCh0aGlzLnNsaWRlSG9sZGVyc1tpXSkuYXR0cihgZGF0YS1uYW1lYCkpO1xuICAgIH1cbiAgfVxuXG4gIG1vYmlsZVNlcnZlck1lc3NhZ2VIYW5kbGVyKG1lc3NhZ2UpIHtcbiAgICBpZihtZXNzYWdlLnRhcmdldC5zbGlkZSkge1xuICAgICAgLy9zbGlkZSBoYXMgdG8gaGFuZGxlIHRoZSBtZXNzYWdlXG4gICAgICBjb25zdCBzbGlkZUJyaWRnZSA9IHRoaXMuZ2V0U2xpZGVCcmlkZ2VCeU5hbWUobWVzc2FnZS50YXJnZXQuc2xpZGUpO1xuICAgICAgaWYoc2xpZGVCcmlkZ2UpIHtcbiAgICAgICAgc2xpZGVCcmlkZ2UudHJ5VG9Qb3N0TWVzc2FnZSh7XG4gICAgICAgICAgYWN0aW9uOiBDb25zdGFudHMuU09DS0VUX1JFQ0VJVkUsXG4gICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy9wcmVzZW50YXRpb24gaGFzIHRvIGhhbmRsZSB0aGUgbWVzc2FnZVxuICAgICAgdGhpcy5oYW5kbGVNb2JpbGVTZXJ2ZXJNZXNzYWdlKG1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZU1vYmlsZVNlcnZlck1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGNvbnNvbGUubG9nKGBbc2hhcmVkL1ByZXNlbnRhdGlvbl0gaGFuZGxlTW9iaWxlU2VydmVyTWVzc2FnZWAsIG1lc3NhZ2UpO1xuICB9XG5cbiAgZ2V0U2xpZGVCcmlkZ2VCeUluZGV4KGluZGV4KSB7XG4gICAgaWYoaW5kZXggPj0gMCAmJiBpbmRleCA8IHRoaXMuc2xpZGVCcmlkZ2VzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2xpZGVCcmlkZ2VzW2luZGV4XTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZ2V0U2xpZGVCcmlkZ2VCeU5hbWUoc2xpZGVOYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuc2xpZGVCcmlkZ2VzQnlTbGlkZU5hbWVbc2xpZGVOYW1lXTtcbiAgfVxuXG4gIGdldFNsaWRlSG9sZGVyRm9yU2xpZGUoc2xpZGUsIHNsaWRlc05vdFRvQ2xlYXIpIHtcbiAgICBpZihzbGlkZSkge1xuICAgICAgbGV0ICRzbGlkZUhvbGRlciA9ICQoYC5zbGlkZS1mcmFtZVtkYXRhLW5hbWU9XCIkeyAgc2xpZGUubmFtZSAgfVwiXWApO1xuICAgICAgaWYoJHNsaWRlSG9sZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuICRzbGlkZUhvbGRlclswXTtcbiAgICAgIH1cbiAgICAgIC8vZ2V0IGEgZnJlZSBzbGlkZUhvbGRlclxuICAgICAgY29uc3Qgc2xpZGVOYW1lc05vdFRvQ2xlYXIgPSBbXTtcbiAgICAgICQoc2xpZGVzTm90VG9DbGVhcikuZWFjaChmdW5jdGlvbihpbmRleCwgb2JqKXtcbiAgICAgICAgc2xpZGVOYW1lc05vdFRvQ2xlYXIucHVzaChvYmoubmFtZSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0ICRzbGlkZUhvbGRlcnMgPSAkKGAuc2xpZGUtZnJhbWVgKTtcbiAgICAgIGZvciAobGV0IGkgPSAkc2xpZGVIb2xkZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICRzbGlkZUhvbGRlciA9ICQoJHNsaWRlSG9sZGVyc1tpXSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSAkc2xpZGVIb2xkZXIuYXR0cihgZGF0YS1uYW1lYCk7XG4gICAgICAgIGlmKCFuYW1lIHx8IHNsaWRlTmFtZXNOb3RUb0NsZWFyLmluZGV4T2YobmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuICRzbGlkZUhvbGRlclswXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnb1RvUHJldmlvdXNTbGlkZSgpIHtcbiAgICB0aGlzLnNldEN1cnJlbnRTbGlkZUluZGV4KHRoaXMuY3VycmVudFNsaWRlSW5kZXggLSAxKTtcbiAgfVxuXG4gIGdvVG9OZXh0U2xpZGUoKSB7XG4gICAgdGhpcy5zZXRDdXJyZW50U2xpZGVJbmRleCh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICsgMSk7XG4gIH1cblxuICBzZXRDdXJyZW50U2xpZGVJbmRleCh2YWx1ZSkge1xuICAgIHZhbHVlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odmFsdWUsIHRoaXMuc2xpZGVCcmlkZ2VzLmxlbmd0aCAtIDEpKTtcbiAgICBpZih2YWx1ZSAhPT0gdGhpcy5jdXJyZW50U2xpZGVJbmRleCkge1xuICAgICAgdGhpcy5jdXJyZW50U2xpZGVJbmRleCA9IHZhbHVlO1xuXG4gICAgICBjb25zdCBjdXJyZW50U2xpZGVCcmlkZ2UgPSB0aGlzLmdldFNsaWRlQnJpZGdlQnlJbmRleCh0aGlzLmN1cnJlbnRTbGlkZUluZGV4KTtcbiAgICAgIGNvbnN0IHByZXZpb3VzU2xpZGVCcmlkZ2UgPSB0aGlzLmdldFNsaWRlQnJpZGdlQnlJbmRleCh0aGlzLmN1cnJlbnRTbGlkZUluZGV4IC0gMSk7XG4gICAgICBjb25zdCBuZXh0U2xpZGVCcmlkZ2UgPSB0aGlzLmdldFNsaWRlQnJpZGdlQnlJbmRleCh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ICsgMSk7XG5cbiAgICAgIC8vcmVtb3ZlIFwidXNlZFwiIGNsYXNzIGZyb20gc2xpZGUgaG9sZGVyc1xuICAgICAgJChgLnNsaWRlLWZyYW1lYCkucmVtb3ZlQXR0cihgZGF0YS11c2VkYCwgZmFsc2UpO1xuXG4gICAgICBjb25zdCBjdXJyZW50U2xpZGVIb2xkZXIgPSB0aGlzLmdldFNsaWRlSG9sZGVyRm9yU2xpZGUoY3VycmVudFNsaWRlQnJpZGdlLCBbcHJldmlvdXNTbGlkZUJyaWRnZSwgbmV4dFNsaWRlQnJpZGdlXSk7XG4gICAgICB0aGlzLnNldHVwU2xpZGVIb2xkZXIoY3VycmVudFNsaWRlSG9sZGVyLCBjdXJyZW50U2xpZGVCcmlkZ2UsIENvbnN0YW50cy5TVEFURV9BQ1RJVkUsIDApO1xuXG4gICAgICBjb25zdCBwcmV2aW91c1NsaWRlSG9sZGVyID0gdGhpcy5nZXRTbGlkZUhvbGRlckZvclNsaWRlKHByZXZpb3VzU2xpZGVCcmlkZ2UsIFtjdXJyZW50U2xpZGVCcmlkZ2UsIG5leHRTbGlkZUJyaWRnZV0pO1xuICAgICAgdGhpcy5zZXR1cFNsaWRlSG9sZGVyKHByZXZpb3VzU2xpZGVIb2xkZXIsIHByZXZpb3VzU2xpZGVCcmlkZ2UsIENvbnN0YW50cy5TVEFURV9JTkFDVElWRSwgYC0xMDAlYCk7XG5cbiAgICAgIGNvbnN0IG5leHRTbGlkZUhvbGRlciA9IHRoaXMuZ2V0U2xpZGVIb2xkZXJGb3JTbGlkZShuZXh0U2xpZGVCcmlkZ2UsIFtwcmV2aW91c1NsaWRlQnJpZGdlLCBjdXJyZW50U2xpZGVCcmlkZ2VdKTtcbiAgICAgIHRoaXMuc2V0dXBTbGlkZUhvbGRlcihuZXh0U2xpZGVIb2xkZXIsIG5leHRTbGlkZUJyaWRnZSwgQ29uc3RhbnRzLlNUQVRFX0lOQUNUSVZFLCBgMTAwJWApO1xuXG4gICAgICAvL2NsZWFyIGF0dHJpYnV0ZXMgb2YgdW51c2VkIHNsaWRlIGZyYW1lc1xuICAgICAgJChgLnNsaWRlLWZyYW1lYCkuZWFjaChmdW5jdGlvbihpbmRleCwgc2xpZGVIb2xkZXIpe1xuICAgICAgICBpZighJChzbGlkZUhvbGRlcikuYXR0cihgZGF0YS11c2VkYCkpIHtcbiAgICAgICAgICAkKHNsaWRlSG9sZGVyKS5yZW1vdmVBdHRyKGBkYXRhLXVzZWRgKS5yZW1vdmVBdHRyKGBkYXRhLW5hbWVgKS5yZW1vdmVBdHRyKGBkYXRhLXNyY2ApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy9hbGwgb3RoZXIgc2xpZGVIb2xkZXIgYnJpZGdlcyBzaG91bGQgYmUgdW5saW5rZWQgZnJvbSB0aGVpciBzbGlkZUhvbGRlclxuICAgICAgdGhpcy5zbGlkZUJyaWRnZXMuZm9yRWFjaChmdW5jdGlvbihzbGlkZUJyaWRnZSl7XG4gICAgICAgIGlmKHNsaWRlQnJpZGdlID09PSBjdXJyZW50U2xpZGVCcmlkZ2UpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2xpZGVCcmlkZ2UgPT09IHByZXZpb3VzU2xpZGVCcmlkZ2UpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2xpZGVCcmlkZ2UgPT09IG5leHRTbGlkZUJyaWRnZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzbGlkZUJyaWRnZS5zbGlkZUhvbGRlciA9IG51bGw7XG4gICAgICB9KTtcblxuICAgICAgYmVhbi5maXJlKHRoaXMsIENvbnN0YW50cy5TRVRfQ1VSUkVOVF9TTElERV9JTkRFWCwgW3RoaXMuY3VycmVudFNsaWRlSW5kZXhdKTtcbiAgICB9XG4gIH1cblxuICBzZXR1cFNsaWRlSG9sZGVyKHNsaWRlSG9sZGVyLCBzbGlkZUJyaWRnZSwgc3RhdGUsIGxlZnQpIHtcbiAgICBpZihzbGlkZUhvbGRlcikge1xuICAgICAgbGV0IHNyYyA9IGBzbGlkZXMvJHsgIHNsaWRlQnJpZGdlLm5hbWUgIH0uaHRtbGA7XG4gICAgICBpZihzbGlkZUJyaWRnZS5kYXRhW3RoaXMucm9sZV0gJiYgc2xpZGVCcmlkZ2UuZGF0YVt0aGlzLnJvbGVdLnVybCkge1xuICAgICAgICBzcmMgPSBzbGlkZUJyaWRnZS5kYXRhW3RoaXMucm9sZV0udXJsO1xuICAgICAgfVxuICAgICAgc3JjID0gdGhpcy5wcm9jZXNzU2xpZGVTcmMoc3JjKTtcbiAgICAgIGlmKHNsaWRlQnJpZGdlLmlzQWxyZWFkeUNvcnJlY3RseUF0dGFjaGVkKHNsaWRlSG9sZGVyLCBzcmMpKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coc2xpZGVCcmlkZ2UubmFtZSArICcgYWxyZWFkeSBhdHRhY2hlZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hdHRhY2hUb1NsaWRlSG9sZGVyKHNsaWRlSG9sZGVyLCBzbGlkZUJyaWRnZSwgc3JjKTtcbiAgICAgIH1cbiAgICAgIHNsaWRlQnJpZGdlLnNldFN0YXRlKHN0YXRlKTtcbiAgICAgICQoc2xpZGVIb2xkZXIpLmNzcyhgbGVmdGAsIGxlZnQpO1xuICAgICAgJChzbGlkZUhvbGRlcikuYXR0cihgZGF0YS11c2VkYCwgMSk7XG4gICAgfVxuICB9XG5cbiAgYXR0YWNoVG9TbGlkZUhvbGRlcihzbGlkZUhvbGRlciwgc2xpZGVCcmlkZ2UsIHNyYykge1xuICAgIC8vbGlzdGVuIGZvciBldmVudHMgb24gdGhpcyBzbGlkZUhvbGRlclxuICAgICQoc2xpZGVIb2xkZXIpLm9mZihgbWVzc2FnZS1mcm9tLXNsaWRlYCk7XG4gICAgJChzbGlkZUhvbGRlcikub24oYG1lc3NhZ2UtZnJvbS1zbGlkZWAsIChldmVudCwgbWVzc2FnZSkgPT4gIHtcbiAgICAgIHRoaXMuc2xpZGVNZXNzYWdlSGFuZGxlcih7ZGF0YTogbWVzc2FnZX0pO1xuICAgIH0pO1xuICAgIC8vbGVhdmUgcHJldmlvdXMgY2hhbm5lbCBvZiB0aGlzIHNsaWRlSG9sZGVyXG4gICAgaWYodGhpcy5tb2JpbGVTZXJ2ZXJCcmlkZ2UpIHtcbiAgICAgIHRoaXMubW9iaWxlU2VydmVyQnJpZGdlLnRyeVRvU2VuZChDb25zdGFudHMuTEVBVkVfU0xJREVfUk9PTSwgJChzbGlkZUhvbGRlcikuYXR0cihgZGF0YS1uYW1lYCkpO1xuICAgIH1cbiAgICAvL2FkZCB0aGUgam9pbiBhcyBhIGNhbGxiYWNrIGZvciB0aGUgb25sb2FkIGV2ZW50XG4gICAgc2xpZGVCcmlkZ2UuYXR0YWNoVG9TbGlkZUhvbGRlcihzbGlkZUhvbGRlciwgc3JjLCB0aGlzLnNsaWRlTG9hZGVkLmJpbmQodGhpcywgc2xpZGVIb2xkZXIsIHNsaWRlQnJpZGdlLCBzcmMpKTtcbiAgfVxuXG4gIHNsaWRlTG9hZGVkKHNsaWRlSG9sZGVyLCBzbGlkZUJyaWRnZSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgLy9qb2luIG5ldyBjaGFubmVsXG4gICAgaWYodGhpcy5tb2JpbGVTZXJ2ZXJCcmlkZ2UpIHtcbiAgICAgIHRoaXMubW9iaWxlU2VydmVyQnJpZGdlLnRyeVRvU2VuZChDb25zdGFudHMuSk9JTl9TTElERV9ST09NLCAkKHNsaWRlSG9sZGVyKS5hdHRyKGBkYXRhLW5hbWVgKSk7XG4gICAgfVxuICB9XG5cbiAgcHJvY2Vzc1NsaWRlU3JjKHNyYykge1xuICAgIHJldHVybiBzcmM7XG4gIH1cblxuICBjcmVhdGVNb2JpbGVTZXJ2ZXJCcmlkZ2UoKSB7XG4gICAgLy90byBpbXBsZW1lbnQgaW4gZXh0ZW5kaW5nIGNsYXNzZXNcbiAgfVxufVxuIiwiaW1wb3J0IGZldGNoIGZyb20gJ2lzb21vcnBoaWMtZmV0Y2gnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbGlkZUJyaWRnZSB7XG4gIGNvbnN0cnVjdG9yKGRhdGEpIHtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMubmFtZSA9IHRoaXMuZGF0YS5uYW1lO1xuICB9XG5cbiAgaXNBbHJlYWR5Q29ycmVjdGx5QXR0YWNoZWQoc2xpZGVIb2xkZXIsIHNyYykge1xuICAgIHJldHVybiAodGhpcy5zbGlkZUhvbGRlciA9PT0gc2xpZGVIb2xkZXIgJiYgJChzbGlkZUhvbGRlcikuYXR0cihgZGF0YS1uYW1lYCkgPT09IHRoaXMubmFtZSAmJiAkKHNsaWRlSG9sZGVyKS5hdHRyKGBkYXRhLXNyY2ApID09PSBzcmMpO1xuICB9XG5cbiAgYXR0YWNoVG9TbGlkZUhvbGRlcihzbGlkZUhvbGRlciwgc3JjLCBjYikge1xuICAgIHRoaXMuc2xpZGVIb2xkZXIgPSBzbGlkZUhvbGRlcjtcbiAgICAvL25vdGlmeSB0aGUgY29udGVudCBpdCBpcyBiZWluZyBjbGVhcmVkXG4gICAgdGhpcy50cnlUb1Bvc3RNZXNzYWdlKHthY3Rpb246IGBkZXN0cm95YH0pO1xuICAgIC8vY2xlYXIgdGhlIGN1cnJlbnQgY29udGVudFxuICAgIHRoaXMuc2xpZGVIb2xkZXIuaW5uZXJIVE1MID0gYGA7XG4gICAgJChzbGlkZUhvbGRlcikuYXR0cihgZGF0YS1uYW1lYCwgdGhpcy5uYW1lKTtcbiAgICAkKHNsaWRlSG9sZGVyKS5hZGRDbGFzcyhgbG9hZGluZ2ApO1xuXG4gICAgJChzbGlkZUhvbGRlcikub2ZmKGBsb2FkYCk7XG4gICAgJChzbGlkZUhvbGRlcikub24oYGxvYWRgLCAoKSA9PiB7XG4gICAgICB0aGlzLnRyeVRvUG9zdE1lc3NhZ2Uoe1xuICAgICAgICBhY3Rpb246IGBzZXRTdGF0ZWAsXG4gICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlXG4gICAgICB9KTtcbiAgICAgICQoc2xpZGVIb2xkZXIpLm9mZihgbG9hZGApO1xuICAgIH0pO1xuXG4gICAgaWYoc3JjICE9PSAkKHNsaWRlSG9sZGVyKS5hdHRyKGBkYXRhLXNyY2ApKSB7XG4gICAgICAvL2ZldGNoIHRoZSBodG1sXG4gICAgICBmZXRjaChzcmMpXG4gICAgICAgIC50aGVuKHJlc3VsdCA9PiByZXN1bHQudGV4dCgpKVxuICAgICAgICAudGhlbihyZXN1bHQgPT4gJChyZXN1bHQpKVxuICAgICAgICAudGhlbigkcmVzdWx0ID0+IHtcbiAgICAgICAgICAkKHNsaWRlSG9sZGVyKS5odG1sKCRyZXN1bHQuaHRtbCgpKTtcbiAgICAgICAgICAkKHNsaWRlSG9sZGVyKS5yZW1vdmVDbGFzcyhgbG9hZGluZ2ApO1xuICAgICAgICAgIGNiKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAkKHNsaWRlSG9sZGVyKS5yZW1vdmVDbGFzcyhgbG9hZGluZ2ApO1xuICAgICAgICAgIGNiKCk7XG4gICAgICAgIH0pO1xuICAgICAgJChzbGlkZUhvbGRlcikuYXR0cihgZGF0YS1zcmNgLCBzcmMpO1xuICAgIH1cbiAgfVxuXG4gIHRyeVRvUG9zdE1lc3NhZ2UobWVzc2FnZSkge1xuICAgIGlmKCF0aGlzLnNsaWRlSG9sZGVyKVxuICAgIHtcbiAgICAgIGNvbnNvbGUubG9nKGAke3RoaXMubmFtZSAgfSBwb3N0IGZhaWxgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy90cmlnZ2VyIHdpdGgganF1ZXJ5XG4gICAgJCh0aGlzLnNsaWRlSG9sZGVyKS50cmlnZ2VyKGBtZXNzYWdlLXRvLXNsaWRlYCwgbWVzc2FnZSk7XG4gIH1cblxuICBzZXRTdGF0ZShzdGF0ZSkge1xuICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICB0aGlzLnRyeVRvUG9zdE1lc3NhZ2Uoe1xuICAgICAgYWN0aW9uOiBgc2V0U3RhdGVgLFxuICAgICAgc3RhdGU6IHRoaXMuc3RhdGVcbiAgICB9KTtcbiAgfVxufVxuIl19"}